{% extends "base.html" %}

{% block title %}Character Creation - D&D Console Adventure{% endblock %}

{% block content %}
{% raw %}
<div id="character-app" v-cloak class="container mx-auto p-4">
  <h1 class="medieval text-3xl mb-4">Character Creation</h1>
  <div class="mb-4">
      <h2 class="medieval text-2xl mb-2">Select Your Race</h2>
      <div class="grid grid-cols-2 gap-4">
         <div v-for="(stats, race) in races" :key="race" @click="selectRace(race)" 
              class="p-4 rounded-lg cursor-pointer border" 
              :class="selectedRace === race ? 'border-red-500 bg-gray-800' : 'border-gray-700 hover:border-gray-500'">
           <h3 class="medieval text-xl">{{ race }}</h3>
           <p>HP: {{ stats.hp }}, Damage: {{ stats.damage }}, Gold: {{ stats.gold }}</p>
         </div>
      </div>
  </div>
  <div class="mb-4">
      <h2 class="medieval text-2xl mb-2">Select Your Class</h2>
      <div class="grid grid-cols-2 gap-4">
         <div v-for="(stats, className) in classes" :key="className" @click="selectClass(className)" 
              class="p-4 rounded-lg cursor-pointer border" 
              :class="selectedClass === className ? 'border-red-500 bg-gray-800' : 'border-gray-700 hover:border-gray-500'">
           <h3 class="medieval text-xl">{{ className }}</h3>
           <p>HP Bonus: +{{ stats.hp_bonus }}, Gold Bonus: +{{ stats.gold_bonus }}, Magic: {{ stats.magic }}</p>
         </div>
      </div>
  </div>
  <div>
    <button @click="createCharacter" :disabled="!selectedRace || !selectedClass || submitted" 
            :class="['w-full', 'bg-red-700', (!selectedRace || !selectedClass || submitted) ? 'opacity-50 cursor-not-allowed' : 'hover:bg-red-600', 'px-4', 'py-2', 'rounded-lg', 'medieval']">
      Begin Adventure
    </button>
  </div>
</div>
<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      races: {},
      classes: {},
      selectedRace: null,
      selectedClass: null,
      submitted: false
    };
  },
  methods: {
    async loadOptions() {
      try {
        const racesResponse = await fetch('/get_races');
        const classesResponse = await fetch('/get_classes');
        this.races = await racesResponse.json();
        this.classes = await classesResponse.json();
      } catch(e) {
        console.error(e);
      }
    },
    selectRace(race) {
      this.selectedRace = race;
    },
    selectClass(className) {
      this.selectedClass = className;
    },
    async createCharacter() {
      if (!this.selectedRace || !this.selectedClass) return;
      this.submitted = true; // disable button after submit
      try {
        const response = await fetch('/choose_character', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ race: this.selectedRace, class: this.selectedClass })
        });
        const data = await response.json();
        if (data.status === 'success') {
          window.location.href = '/game';
        } else {
          alert(data.error || 'Error creating character');
          this.submitted = false;
        }
      } catch(e) {
        console.error(e);
        this.submitted = false;
      }
    }
  },
  mounted() {
    this.loadOptions();
  }
}).mount('#character-app');
</script>
{% endraw %}
{% endblock %} 