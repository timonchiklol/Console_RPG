{% extends "ru/base.html" %}

{% block title %}Главная{% endblock %}

{% block content %}
<div id="app" v-cloak class="container mx-auto p-4">
  <h1 class="medieval text-3xl mb-4">Добро пожаловать в Приключение D&D</h1>
  <div class="mb-4">
    <input v-model="playerName" placeholder="Введите ваше имя" class="px-4 py-2 rounded-lg bg-gray-700 text-white w-full">
  </div>
  <div class="mb-4">
    <button @click="createRoom" :disabled="!playerName.trim()" 
            :class="['bg-green-700', !playerName.trim() ? 'opacity-50 cursor-not-allowed' : 'hover:bg-green-600', 'px-4', 'py-2', 'rounded-lg', 'medieval', 'w-full']">
      Создать комнату
    </button>
  </div>
  <div class="mb-4">
    <input v-model="joinRoomId" placeholder="Введите код комнаты" class="px-4 py-2 rounded-lg bg-gray-700 text-white w-full mb-2">
    <button @click="joinRoom" :disabled="!playerName.trim() || !joinRoomId.trim()" 
            :class="['bg-blue-700', (!playerName.trim() || !joinRoomId.trim()) ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-600', 'px-4', 'py-2', 'rounded-lg', 'medieval', 'w-full']">
      Присоединиться к комнате
    </button>
  </div>

  <div class="mb-4">
    <button @click="feedbackVisible = true" 
            class="bg-red-900 hover:bg-red-800 px-4 py-2 rounded-lg medieval w-full">
      Обратная связь
    </button>
  </div>

  <div v-if="feedbackVisible" class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-blue-900 p-6 rounded-lg shadow-lg text-white">
      <h2 class="text-xl font-bold mb-2">Обратная связь</h2>
      <p class="mb-4">Наша почта: flappyfeedback@gmail.com</p>
      <button @click="feedbackVisible = false" class="bg-red-700 hover:bg-red-600 px-4 py-2 rounded-lg text-white">
        Закрыть
      </button>
    </div>
  </div>
</div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            playerName: '',
            joinRoomId: '',
            roomJoined: false,
            roomId: '',
            feedbackVisible: false
        };
    },
    methods: {
        async createRoom() {
            if (!this.playerName.trim()) return;
            try {
                const response = await fetch('/create_room', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ player_name: this.playerName })
                });
                const data = await response.json();
                if (data.status === 'success') {
                    this.roomId = data.room_id;
                    this.roomJoined = true;
                    window.location.href = '/character';
                } else {
                    alert('Ошибка при создании комнаты');
                }
            } catch (e) {
                console.error(e);
            }
        },
        async joinRoom() {
            if (!this.playerName.trim() || !this.joinRoomId.trim()) return;
            try {
                const response = await fetch('/join_room', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ player_name: this.playerName, room_id: this.joinRoomId })
                });
                const data = await response.json();
                if (data.status === 'success') {
                    this.roomId = data.room_id;
                    this.roomJoined = true;
                    window.location.href = '/character';
                } else {
                    alert(data.message || 'Ошибка при присоединении к комнате.');
                }
            } catch (e) {
                console.error(e);
            }
        }
    }
}).mount('#app');
</script>
{% endblock %} 